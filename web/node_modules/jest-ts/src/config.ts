import { resolve } from "path";
import type { JestTsOptions } from "./types";

const DEFAULT_CONFIG: JestTsOptions = {
  cacheDirectory: resolve(process.cwd(), "node_modules/.cache/jest-ts"),
  typeCheck: false,
  tsconfigPath: resolve(process.cwd(), "tsconfig.json")
};

export function resolveConfig(globals?: { "jest-ts"?: Partial<JestTsOptions> }): JestTsOptions {
  const userConfig = globals?.["jest-ts"] || {};

  return {
    ...DEFAULT_CONFIG,
    ...userConfig,
    cacheDirectory: userConfig.cacheDirectory 
      ? resolve(userConfig.cacheDirectory) 
      : DEFAULT_CONFIG.cacheDirectory,
    tsconfigPath: userConfig.tsconfigPath
      ? resolve(userConfig.tsconfigPath)
      : DEFAULT_CONFIG.tsconfigPath
  };
}
