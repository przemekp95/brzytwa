import { defineConfig } from "tsup";

export default defineConfig({
  // 关键：明确包含所有核心入口，尤其是 src/jest-preset.ts
  entry: [
    "src/index.ts",
    "src/jest-preset.ts", // 必须包含，否则不生成 jest-preset.js
    "src/transformer.ts",
    "src/cli/init.ts"
  ],
  format: ["cjs"], // 预设需用 CommonJS 格式（Jest 兼容）
  dts: {
    generate: true,
    workers: false // 避免类型生成时的多进程问题
  },
  outDir: "dist",
  clean: true, // 打包前清空 dist，确保旧文件被替换
  entryNames: "[dir]/[name]", // 保留目录结构（src/jest-preset.ts → dist/jest-preset.js）
  sourcemap: false,
  minify: false,
  target: "es2020",
  splitting: false,
  preserveModules: false,
  external: [
    "esbuild",
    "typescript",
    "@jest/types",
    "chalk",
    "fs-extra",
    "path"
  ]
});
